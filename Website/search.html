<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="index.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <title> &#128191;&#128218;&#10084;&#65039;</title>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FHD6477T2S"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FHD6477T2S');
</script>

<body>

    <header>
        <a href="index.html"><img class="logo" src="Images/AudioBook.LoveLogo.png" alt="AudioBook.Love Logo image"></a>
        <nav>  
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a class="active" href="search.html">Search</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>
    
    <article style="text-align: center;">  
        <div class="search-container">
            <h3 style="color: #BF8AAD;">Search Results </h3>
            <p>Use the search box to search for an audiobook by Title, Author, or ISBN.</p>
            <form id="searchForm" action="" method="GET">
                <input type="text" name="query" id="query" placeholder="Enter an Audiobook Title, Author, or ISBN">
              <button type="submit"><i class="fa fa-search"></i></button>
            </form>
            <br>
            <div id="results"></div>
            <script>
                $(document).ready(function() {
                    $("#searchForm").on("submit", function(e) {
                        e.preventDefault();
                        const query = $("#query").val().trim();
                        searchAudiobook(query);
                    });
        
                    function searchAudiobook(query) {
                        const resultUrl = `item.html?title=${encodeURIComponent(title)}&author=${encodeURIComponent(author)}&isbn=${encodeURIComponent(isbn)}&openLibraryUrl=${encodeURIComponent(url)}&coverUrl=${encodeURIComponent(coverUrl)}`;
                        
                        window.location.href = resultUrl;

                        $.ajax({
                            url: url,
                            method: "GET",
                            dataType: "json",
                            success: function(data) {
                                if (data.docs && data.docs.length > 0) {
                                    let resultsHtml = "";
                                    data.docs.forEach(doc => {
                                        const title = doc.title || "N/A";
                                        const author = doc.author_name && doc.author_name[0] ? doc.author_name[0] : "N/A";
                                        const isbn = doc.isbn && doc.isbn[0] ? doc.isbn[0] : "N/A";
                                        const url = doc.key ? `item.html?key=${doc.key}` : "#";
                                        const coverUrl = doc.cover_i ? `https://covers.openlibrary.org/b/id/${doc.cover_i}-L.jpg` : "no-image.png";
                                        resultsHtml += `
                                            <a class="book-result" href="${url}">
                                                <img class="book-cover" src="${coverUrl}" alt="Book Cover">
                                                <div>
                                                    <h3>Title: ${title}</h3>
                                                    <p>Author: ${author}</p>
                                                    <p>ISBN: ${isbn}</p>
                                                </div>
                                            </a>
                                            <hr> 
                                        `;
                                    });
                                    $("#results").html(resultsHtml);
                                } else {
                                    $("#results").html("No audiobooks found.");
                                }
                            },
                            error: function() {
                                $("#results").html("Error occurred while searching for audiobooks.");
                            }
                        });
                    }
                });
            </script>
        </article>

    <footer>
        <p>AudioBook.Love | Tamia Taylor-Bader | May 2023</p>
    </footer>

</body>

</html>